<html>

	<head>
		<script type="text/javascript" src="libraries/d3.min.js"></script> 
<!--		<script src="https://d3js.org/d3.v5.min.js"></script>-->
		<!-- include the path to the leaflet.js library -->
		<script type="text/javascript" src="libraries/leaflet.js"></script>
		
		<!-- include external stylesheet for leaflet -->
		<link rel="stylesheet" href="libraries/leaflet.css"/>
		
        <link href="https://fonts.googleapis.com/css?family=Orbitron" rel="stylesheet">
		<!-- define width and height of the div with the name/id "map" -->
		<!-- the # indicates that "map" is an id -->
		<style>
			#map
			{
				width: 50%;
				height: 90%;
			}
            
            
            body {
                font-family: 'Orbitron', sans-serif;
                background-color: black;
                color: white;
            }
            
            #controls {
                float: left;
            }
		</style>
		
		
		<title>D3 UFO sighting map</title>
	</head>

	<body>
		<h2>UFO Sighting Map</h2>
				
        <div id="controls">
        <button onclick="minusYear()">-1 year</button><p id="year"></p><button onclick="addYear()">+1 year</button>
        
        </div>
		<!-- div container element with the id "map" -->
		<div id="map">				
		
		</div>
		
		<script>
			
			//add open street map element to div
			var map = L.map('map').setView([55.9531, -3.1889], 5);			// the first array includes the latitude and longitude in the centre
																			//the integer value (11) indicates the zoom level
			
			L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png',{
				attribution: '&copy; <a href="href://osm.org/copyright">OpenStreetMap</a> contributors'
				}).addTo(map);
            
            
            var myIcon = L.icon({
                iconUrl: 'images/ufo.png',
                iconSize: [30, 30],
                iconAnchor: [0, 30],
                popupAnchor: [0, 20],
            });

            var dataPath = "ufo-sightings/complete.csv";
//            var dataPath = "edinburghLocations.csv";
            
            //on load, place markers for all UK-based sightings in the year 2000
            var year = 2000;
            
            var currentLayer;
            
            //make a new layer group
            var markersLayer = new L.LayerGroup();
            
            //fill the layer with UFO elements for each UK-based UFO sighting
            d3.csv(dataPath, function(error, data){
                var myData = data;
                console.log(data);
                var marker;
                myData.forEach(function(d){
                    if (d.country == "gb" && d.datetime.substr(6, 4) == year){
                        //place marker using UFO icon
                        var markerText = "City" + d.city;
                        marker = L.marker([d.latitude, d.longitude], {icon: myIcon}).addTo(map)
                        .bindTooltip("<b>City: </b>"  + d.city.substring(0, str.indexOf("("))  + "<br><b>Type: </b>" + d.shape);
                        currentLayer = L.marker([d.latitude, d.longitude], {icon: myIcon});
                        markersLayer.addLayer(marker); 
                        markersLayer.addTo(map);
                    }
                })
            })
            
            function addYear() {
                year++;
                displayYear();
                console.log(year);
                reload();
            }
            
            function minusYear() {
                year--;
                displayYear();
                console.log(year);
                reload();
            }
            
            function reload() {
                markersLayer.remove();
                markersLayer.clearLayers();
                d3.csv(dataPath, function(error, data){
                var myData = data;
                console.log(data);
                
                myData.forEach(function(d){
                    if (d.country == "gb" && d.datetime.substr(6, 4) == year){
                        if (d.country == "gb" && d.datetime.substr(6, 4) == year){
                            marker = L.marker([d.latitude, d.longitude], {icon: myIcon}).addTo(map)                  .bindTooltip("<b>City: </b>"  + d.city.substring(0, str.indexOf("("))  + "<br><b>Type: </b>" + d.shape);
                            currentLayer = L.marker([d.latitude, d.longitude], {icon: myIcon});
                            markersLayer.addLayer(marker); 
                            markersLayer.addTo(map);
                    }
                    }
                })
            })
            }
            
            function displayYear() {
                document.getElementById("year").innerHTML = year;
            }
            
            displayYear();
            
		</script>
		
	</body>

</html>